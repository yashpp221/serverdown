window.slate = window.slate || {},
slate.utils = {
    findInstance: function(t, n, e) {
        for (var o = 0; o < t.length; o++)
            if (t[o][n] === e)
                return t[o]
    },
    removeInstance: function(t, n, e) {
        for (var o = t.length; o--; )
            if (t[o][n] === e) {
                t.splice(o, 1);
                break
            }
        return t
    },
    compact: function(t) {
        for (var n = -1, e = null == t ? 0 : t.length, o = 0, i = []; ++n < e; ) {
            var s = t[n];
            s && (i[o++] = s)
        }
        return i
    },
    defaultTo: function(t, n) {
        return null == t || t != t ? n : t
    },
    debounce: function(t, n, e) {
        var o;
        return function() {
            var i = this
              , s = arguments
              , c = e && !o;
            clearTimeout(o),
            o = setTimeout(function() {
                o = null,
                e || t.apply(i, s)
            }, n),
            c && t.apply(i, s)
        }
    }
},
window.theme = window.theme || {},
theme.Sections = function() {
    this.constructors = {},
    this.instances = [],
    $(document).on("shopify:section:load", this._onSectionLoad.bind(this)).on("shopify:section:unload", this._onSectionUnload.bind(this)).on("shopify:section:select", this._onSelect.bind(this)).on("shopify:section:deselect", this._onDeselect.bind(this)).on("shopify:section:reorder", this._onReorder.bind(this)).on("shopify:block:select", this._onBlockSelect.bind(this)).on("shopify:block:deselect", this._onBlockDeselect.bind(this))
}
,
theme.Sections.prototype = $.extend({}, theme.Sections.prototype, {
    _createInstance: function(t, n) {
        var e = $(t)
          , o = e.attr("data-section-id")
          , i = e.attr("data-section-type");
        if (void 0 !== (n = n || this.constructors[i])) {
            var s = $.extend(new n(t), {
                id: o,
                type: i,
                container: t
            });
            this.instances.push(s)
        }
    },
    _onSectionLoad: function(t) {
        var n = $("[data-section-id]", t.target)[0];
        n && this._createInstance(n)
    },
    _onSectionUnload: function(t) {
        var n = slate.utils.findInstance(this.instances, "id", t.detail.sectionId);
        n && ("function" == typeof n.onUnload && n.onUnload(t),
        this.instances = slate.utils.removeInstance(this.instances, "id", t.detail.sectionId))
    },
    _onSelect: function(t) {
        var n = slate.utils.findInstance(this.instances, "id", t.detail.sectionId);
        n && "function" == typeof n.onSelect && n.onSelect(t),
        $("body").hasClass("panel-open") && (theme.closePanelMenu(),
        $("html, body").addClass("scroll-lock"),
        setTimeout(function() {
            $("html, body").removeClass("scroll-lock"),
            $("html, body").animate({
                scrollTop: n.$container.offset().top
            }, 600)
        }, 400))
    },
    _onDeselect: function(t) {
        var n = slate.utils.findInstance(this.instances, "id", t.detail.sectionId);
        n && "function" == typeof n.onDeselect && n.onDeselect(t),
        $("body").hasClass("panel-open") && theme.closePanelMenu()
    },
    _onReorder: function(t) {
        var n = slate.utils.findInstance(this.instances, "id", t.detail.sectionId);
        n && "function" == typeof n.onReorder && n.onReorder(t)
    },
    _onBlockSelect: function(t) {
        var n = slate.utils.findInstance(this.instances, "id", t.detail.sectionId);
        n && "function" == typeof n.onBlockSelect && n.onBlockSelect(t)
    },
    _onBlockDeselect: function(t) {
        var n = slate.utils.findInstance(this.instances, "id", t.detail.sectionId);
        n && "function" == typeof n.onBlockDeselect && n.onBlockDeselect(t)
    },
    register: function(t, n) {
        this.constructors[t] = n,
        $("[data-section-type=" + t + "]").each(function(t, e) {
            this._createInstance(e, n)
        }
        .bind(this))
    }
});
